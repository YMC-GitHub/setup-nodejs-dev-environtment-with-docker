

Docker的使用场景通常是多应用、多服务器的生产环境或持续集成中的测试环境，用于开发环境的案例比较少，能看到的案例也仅仅是启动容器、构建镜像，实际应用、深入探索者寥寥。此处，利用Docker的虚拟化技术，容器的虚拟运行环境来运行我们开发环境下的程序。
（拓：大课题————利用Docker的虚拟化技术，统一开发环境，生产环境和测试环境。）


#### 解决一些问题(how to use docker in development)

（系统平台）Docker在Linux、Mac、Windows三大操作系统都能安装（win10以下版本需要使用docker toolbox），所以Docker容器是跨平台的，镜像一致即容器一致。

（软件版本）对于切换nodejs版本的问题，利用不同版本的nodejs镜像来创建容器即可轻松实现。（语言版本）

（开发环境下的调试）调试起来也非常方便，利用Node.js自带的inspector功能，配合visual studio code的remote debuger可轻松实现断点、重启等操作。

（开发环境下的依赖缓存）要减少npm install的时间，在不修改npm本身的情况下，路径只有一条：缓存node_modules下的模块。如何缓存？参考[利用Docker容器搭建高效的Node.js开发环境](https://www.imooc.com/article/19840)中的一些思考。


（工程目录）在这个[nodejs项目结构](./projet-dir-construtor.md)中，src、package.json是开发中可能需要修改的目录和文件，node_modules是需要被缓存的目录，dist是需要用来部署、执行的目录。用Docker容器管理项目在此便会出现分歧。

假如在编写Dockerfile来构建镜像时，将node_modules放入镜像中，然后挂载源码路径，这样以后搭建开发环境可以直接通过镜像创建容器来实现，不过这样存的问题是：


每次配置文件改动、模块依赖变化都需要重新build。即使不build直接在容器中用npm安装，但是由于package.json是文件，无法挂载，所以导致又需要手动同步配置文件，这些都是相当麻烦而且容易出错的。

要不直接挂载整个项目？但是这样并不能缓存node_modules目录，只是在容器中执行node进程而已。

把node_modules再单独挂载一次不就行了？很遗憾，Docker并不支持这种嵌套挂载宿主机目录的方式。

用另外的方式挂载node_modules来进行缓存，比如说把它和另一个容器进行挂载（数据卷容器）？把数据保存在容器中并不是一种值得推荐的做法，抛开Docker守护进程和容器本身的稳定性不说，容器也存在一定被误删的可能性。

创建一个Docker volume用来共享容器间的数据？这个volume可以叫任意名字，也可以挂载到容器不同的路径下。（环境优化）

（开发环境下的自动编译/刷新）利用Docker容器搭建开发环境可能碰到最麻烦的问题便是无法实现自动刷新、编译，尤其是对于系统环境为Windows的用户，由于NFS存储卷底层的事件消息与Docker容器通信有些问题，导致Node.js模块的监听文件变化的功能失效。（据部分开发者反映Mac系统下可能也会出现这种问题）

所以主流常用的Node.js模块都会支持设置参数来开启以轮询模式，检测文件修改。
如前端目前常用的构建工具gulp就支持开启poll模式。
前端模块构建工具webpack也是提供了poll选项。


